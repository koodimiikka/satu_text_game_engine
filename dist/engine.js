!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){var s;!function(){function n(t,e,i){return t.call.apply(t.bind,arguments)}function a(t,e,i){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,s),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function r(t,e,i){return(r=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?n:a).apply(null,arguments)}var o=Date.now||function(){return+new Date};function c(t,e){this.a=t,this.o=e||t,this.c=this.o.document}var h=!!window.FontFace;function l(t,e,i,s){if(e=t.c.createElement(e),i)for(var n in i)i.hasOwnProperty(n)&&("style"==n?e.style.cssText=i[n]:e.setAttribute(n,i[n]));return s&&e.appendChild(t.c.createTextNode(s)),e}function f(t,e,i){(t=t.c.getElementsByTagName(e)[0])||(t=document.documentElement),t.insertBefore(i,t.lastChild)}function u(t){t.parentNode&&t.parentNode.removeChild(t)}function d(t,e,i){e=e||[],i=i||[];for(var s=t.className.split(/\s+/),n=0;n<e.length;n+=1){for(var a=!1,r=0;r<s.length;r+=1)if(e[n]===s[r]){a=!0;break}a||s.push(e[n])}for(e=[],n=0;n<s.length;n+=1){for(a=!1,r=0;r<i.length;r+=1)if(s[n]===i[r]){a=!0;break}a||e.push(s[n])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function g(t,e){for(var i=t.className.split(/\s+/),s=0,n=i.length;s<n;s++)if(i[s]==e)return!0;return!1}function v(t,e,i){function s(){o&&n&&a&&(o(r),o=null)}e=l(t,"link",{rel:"stylesheet",href:e,media:"all"});var n=!1,a=!0,r=null,o=i||null;h?(e.onload=function(){n=!0,s()},e.onerror=function(){n=!0,r=Error("Stylesheet failed to load"),s()}):setTimeout((function(){n=!0,s()}),0),f(t,"head",e)}function y(t,e,i,s){var n=t.c.getElementsByTagName("head")[0];if(n){var a=l(t,"script",{src:e}),r=!1;return a.onload=a.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,i&&i(null),a.onload=a.onreadystatechange=null,"HEAD"==a.parentNode.tagName&&n.removeChild(a))},n.appendChild(a),setTimeout((function(){r||(r=!0,i&&i(Error("Script load timeout")))}),s||5e3),a}return null}function x(){this.a=0,this.c=null}function m(t){return t.a++,function(){t.a--,w(t)}}function p(t,e){t.c=e,w(t)}function w(t){0==t.a&&t.c&&(t.c(),t.c=null)}function A(t){this.a=t||"-"}function b(t,e){this.c=t,this.f=4,this.a="n";var i=(e||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function k(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var s=t[i].replace(/['"]/g,"");-1!=s.indexOf(" ")||/^\d/.test(s)?e.push("'"+s+"'"):e.push(s)}return e.join(",")}function S(t){return t.a+t.f}function C(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function O(t){var e=4,i="n",s=null;return t&&((s=t.match(/(normal|oblique|italic)/i))&&s[1]&&(i=s[1].substr(0,1).toLowerCase()),(s=t.match(/([1-9]00|normal|bold)/i))&&s[1]&&(/bold/i.test(s[1])?e=7:/[1-9]00/.test(s[1])&&(e=parseInt(s[1].substr(0,1),10)))),i+e}function T(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new A("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function _(t){if(t.g){var e=g(t.f,t.a.c("wf","active")),i=[],s=[t.a.c("wf","loading")];e||i.push(t.a.c("wf","inactive")),d(t.f,i,s)}D(t,"inactive")}function D(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,S(i)):t.h[e]())}function E(){this.c={}}function B(t,e){this.c=t,this.f=e,this.a=l(this.c,"span",{"aria-hidden":"true"},this.f)}function I(t){f(t.c,"body",t.a)}function M(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+k(t.c)+";font-style:"+C(t)+";font-weight:"+t.f+"00;"}function P(t,e,i,s,n,a){this.g=t,this.j=e,this.a=s,this.c=i,this.f=n||3e3,this.h=a||void 0}function j(t,e,i,s,n,a,r){this.v=t,this.B=e,this.c=i,this.a=s,this.s=r||"BESbswy",this.f={},this.w=n||3e3,this.u=a||null,this.m=this.j=this.h=this.g=null,this.g=new B(this.c,this.s),this.h=new B(this.c,this.s),this.j=new B(this.c,this.s),this.m=new B(this.c,this.s),t=M(t=new b(this.a.c+",serif",S(this.a))),this.g.a.style.cssText=t,t=M(t=new b(this.a.c+",sans-serif",S(this.a))),this.h.a.style.cssText=t,t=M(t=new b("serif",S(this.a))),this.j.a.style.cssText=t,t=M(t=new b("sans-serif",S(this.a))),this.m.a.style.cssText=t,I(this.g),I(this.h),I(this.j),I(this.m)}A.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},P.prototype.start=function(){var t=this.c.o.document,e=this,i=o(),s=new Promise((function(s,n){!function a(){o()-i>=e.f?n():t.fonts.load(function(t){return C(t)+" "+t.f+"00 300px "+k(t.c)}(e.a),e.h).then((function(t){1<=t.length?s():setTimeout(a,25)}),(function(){n()}))}()})),n=null,a=new Promise((function(t,i){n=setTimeout(i,e.f)}));Promise.race([a,s]).then((function(){n&&(clearTimeout(n),n=null),e.g(e.a)}),(function(){e.j(e.a)}))};var N={D:"serif",C:"sans-serif"},Q=null;function H(){if(null===Q){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);Q=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return Q}function F(t,e,i){for(var s in N)if(N.hasOwnProperty(s)&&e===t.f[N[s]]&&i===t.f[N[s]])return!0;return!1}function L(t){var e,i=t.g.a.offsetWidth,s=t.h.a.offsetWidth;(e=i===t.f.serif&&s===t.f["sans-serif"])||(e=H()&&F(t,i,s)),e?o()-t.A>=t.w?H()&&F(t,i,s)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?R(t,t.v):R(t,t.B):function(t){setTimeout(r((function(){L(this)}),t),50)}(t):R(t,t.v)}function R(t,e){setTimeout(r((function(){u(this.g.a),u(this.h.a),u(this.j.a),u(this.m.a),e(this.a)}),t),0)}function z(t,e,i){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=i}j.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=o(),L(this)};var G=null;function U(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&d(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),D(t,"active")):_(t.a))}function Y(t){this.j=t,this.a=new E,this.h=0,this.f=this.g=!0}function K(t,e,i,s,n){var a=0==--t.h;(t.f||t.g)&&setTimeout((function(){var t=n||null,o=s||{};if(0===i.length&&a)_(e.a);else{e.f+=i.length,a&&(e.j=a);var c,h=[];for(c=0;c<i.length;c++){var l=i[c],f=o[l.c],u=e.a,g=l;if(u.g&&d(u.f,[u.a.c("wf",g.c,S(g).toString(),"loading")]),D(u,"fontloading",g),u=null,null===G)if(window.FontFace){g=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var v=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);G=g?42<parseInt(g[1],10):!v}else G=!1;u=G?new P(r(e.g,e),r(e.h,e),e.c,l,e.s,f):new j(r(e.g,e),r(e.h,e),e.c,l,e.s,t,f),h.push(u)}for(c=0;c<h.length;c++)h[c].start()}}),0)}function X(t,e){this.c=t,this.a=e}function J(t,e){this.c=t,this.a=e}function q(t,e){this.c=t||V,this.a=[],this.f=[],this.g=e||""}z.prototype.g=function(t){var e=this.a;e.g&&d(e.f,[e.a.c("wf",t.c,S(t).toString(),"active")],[e.a.c("wf",t.c,S(t).toString(),"loading"),e.a.c("wf",t.c,S(t).toString(),"inactive")]),D(e,"fontactive",t),this.m=!0,U(this)},z.prototype.h=function(t){var e=this.a;if(e.g){var i=g(e.f,e.a.c("wf",t.c,S(t).toString(),"active")),s=[],n=[e.a.c("wf",t.c,S(t).toString(),"loading")];i||s.push(e.a.c("wf",t.c,S(t).toString(),"inactive")),d(e.f,s,n)}D(e,"fontinactive",t),U(this)},Y.prototype.load=function(t){this.c=new c(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,function(t,e,i){var s=[],n=i.timeout;!function(t){t.g&&d(t.f,[t.a.c("wf","loading")]),D(t,"loading")}(e);s=function(t,e,i){var s,n=[];for(s in e)if(e.hasOwnProperty(s)){var a=t.c[s];a&&n.push(a(e[s],i))}return n}(t.a,i,t.c);var a=new z(t.c,e,n);for(t.h=s.length,e=0,i=s.length;e<i;e++)s[e].load((function(e,i,s){K(t,a,e,i,s)}))}(this,new T(this.c,t),t)},X.prototype.load=function(t){var e=this,i=e.a.projectId,s=e.a.version;if(i){var n=e.c.o;y(this.c,(e.a.api||"https://fast.fonts.net/jsapi")+"/"+i+".js"+(s?"?v="+s:""),(function(s){s?t([]):(n["__MonotypeConfiguration__"+i]=function(){return e.a},function e(){if(n["__mti_fntLst"+i]){var s,a=n["__mti_fntLst"+i](),r=[];if(a)for(var o=0;o<a.length;o++){var c=a[o].fontfamily;null!=a[o].fontStyle&&null!=a[o].fontWeight?(s=a[o].fontStyle+a[o].fontWeight,r.push(new b(c,s))):r.push(new b(c))}t(r)}else setTimeout((function(){e()}),50)}())})).id="__MonotypeAPIScript__"+i}else t([])},J.prototype.load=function(t){var e,i,s=this.a.urls||[],n=this.a.families||[],a=this.a.testStrings||{},r=new x;for(e=0,i=s.length;e<i;e++)v(this.c,s[e],m(r));var o=[];for(e=0,i=n.length;e<i;e++)if((s=n[e].split(":"))[1])for(var c=s[1].split(","),h=0;h<c.length;h+=1)o.push(new b(s[0],c[h]));else o.push(new b(s[0]));p(r,(function(){t(o,a)}))};var V="https://fonts.googleapis.com/css";function Z(t){this.f=t,this.a=[],this.c={}}var W={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},$={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},tt={i:"i",italic:"i",n:"n",normal:"n"},et=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function it(t,e){this.c=t,this.a=e}var st={Arimo:!0,Cousine:!0,Tinos:!0};function nt(t,e){this.c=t,this.a=e}function at(t,e){this.c=t,this.f=e,this.a=[]}it.prototype.load=function(t){var e=new x,i=this.c,s=new q(this.a.api,this.a.text),n=this.a.families;!function(t,e){for(var i=e.length,s=0;s<i;s++){var n=e[s].split(":");3==n.length&&t.f.push(n.pop());var a="";2==n.length&&""!=n[1]&&(a=":"),t.a.push(n.join(a))}}(s,n);var a=new Z(n);!function(t){for(var e=t.f.length,i=0;i<e;i++){var s=t.f[i].split(":"),n=s[0].replace(/\+/g," "),a=["n4"];if(2<=s.length){var r;if(r=[],o=s[1])for(var o,c=(o=o.split(",")).length,h=0;h<c;h++){var l;if((l=o[h]).match(/^[\w-]+$/))if(null==(u=et.exec(l.toLowerCase())))l="";else{if(l=null==(l=u[2])||""==l?"n":tt[l],null==(u=u[1])||""==u)u="4";else var f=$[u],u=f||(isNaN(u)?"4":u.substr(0,1));l=[l,u].join("")}else l="";l&&r.push(l)}0<r.length&&(a=r),3==s.length&&(r=[],0<(s=(s=s[2])?s.split(","):r).length&&(s=W[s[0]])&&(t.c[n]=s))}for(t.c[n]||(s=W[n])&&(t.c[n]=s),s=0;s<a.length;s+=1)t.a.push(new b(n,a[s]))}}(a),v(i,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],s=0;s<e;s++)i.push(t.a[s].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(s),m(e)),p(e,(function(){t(a.a,a.c,st)}))},nt.prototype.load=function(t){var e=this.a.id,i=this.c.o;e?y(this.c,(this.a.api||"https://use.typekit.net")+"/"+e+".js",(function(e){if(e)t([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){e=i.Typekit.config.fn;for(var s=[],n=0;n<e.length;n+=2)for(var a=e[n],r=e[n+1],o=0;o<r.length;o++)s.push(new b(a,r[o]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}t(s)}}),2e3):t([])},at.prototype.load=function(t){var e=this.f.id,i=this.c.o,s=this;e?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[e]=function(e,i){for(var n=0,a=i.fonts.length;n<a;++n){var r=i.fonts[n];s.a.push(new b(r.name,O("font-weight:"+r.weight+";font-style:"+r.style)))}t(s.a)},y(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(t){return t.o.location.hostname||t.a.location.hostname}(this.c)+"/"+e+".js",(function(e){e&&t([])}))):t([])};var rt=new Y(window);rt.a.c.custom=function(t,e){return new J(e,t)},rt.a.c.fontdeck=function(t,e){return new at(e,t)},rt.a.c.monotype=function(t,e){return new X(e,t)},rt.a.c.typekit=function(t,e){return new nt(e,t)},rt.a.c.google=function(t,e){return new it(e,t)};var ot={load:r(rt.load,rt)};void 0===(s=function(){return ot}.call(e,i,e,t))||(t.exports=s)}()},function(t,e,i){"use strict";i.r(e);var s=i(0),n=i.n(s);function a(t){var e=new Image;return new Promise((function(i,s){e.onload=function(){i(e)},e.onerror=function(t){s(t)},e.src=t}))}function r(t){return null===t[0]?null:"rgb("+t[0]+", "+t[1]+", "+t[2]+")"}function o(t,e,i,s){for(var n=e.split(" "),a=[],r=[],o=0,c=0;o<n.length&&!(c>s);o+=1){var h=Object.assign([],r);h.push(n[o]);var l=h.join(" ");if(t.measureText(l).width>=i){var f=r.join(" ");a.push(f),c+=16,r=[],o+1==n.length&&a.push(n[o])}else o+1==n.length&&a.push(l);r.push(n[o])}return a}function c(t){if("#"==t.charAt(0))return!0;var e=t.indexOf(","),i=t.indexOf(",",e+1),s=parseFloat(t.substr(t.indexOf(",",i+1)+1,t.indexOf(")")));return!!isNaN(s)||0!=s}function h(t,e){t.beginPath(),t.moveTo(e.x+e.r[3],e.y),t.arcTo(e.x+e.w,e.y,e.x+e.w,e.y+e.h,e.r[0]),t.arcTo(e.x+e.w,e.y+e.h,e.x,e.y+e.h,e.r[1]),t.arcTo(e.x,e.y+e.h,e.x,e.y,e.r[2]),t.arcTo(e.x,e.y,e.x+e.w,e.y,e.r[3]),t.closePath()}function l(t,e,i){var s=document.createElement("canvas");s.width=960,s.height=32;var n=s.getContext("2d");i=void 0===i?32:i;var a=s.width,r=s.height;n.font=e,n.textAlign="start",n.textBaseline="top",n.fillText(t,0,0);for(var o=n.getImageData(0,0,a,r).data,c=-1,h=-1,l=0;l<r;l+=1){for(var f=0;f<a;f+=1){if(o[4*(a*l+f)+3]>0){c=l;break}}if(c>=0)break}for(var u=r;u>0;u-=1){for(var d=0;d<a;d+=1){if(o[4*(a*u+d)+3]>0){h=u;break}}if(h>=0)break}return{height:h-c,firstPixel:c,lastPixel:h,top:Math.floor((i-(h-c))/2-c)}}function f(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cnvs=e,this.ctxs=e.map((function(t){return t.getContext("2d")})),this.ctxs[1].font="normal 16px fsex300",this.ctxs[1].textAlign="start",this.ctxs[1].textBaseline="top",this.margin={left:(this.cnvs[0].width-840)/2,top:(this.cnvs[0].height-560)/2},this.inventory={items:[],width:182,height:64,margin:8},this.lineheight=16,this.codes=[[0,0,0,255],[170,0,0,255],[0,170,0,255],[170,85,0,255],[0,0,170,255],[170,0,170,255],[0,170,170,255],[170,170,170,255],[85,85,85,255],[255,85,85,255],[85,255,85,255],[255,255,85,255],[85,85,255,255],[255,85,255,255],[85,255,255,255],[255,255,255,255]],this.config={id:null},this.section=null,this.drawn={ctx:!1,bg:!1}}var e,i,s;return e=t,(i=[{key:"draw",value:function(t,e,i){if(this.drawn.ctx=!1,this.drawn.bg=!1,this.config.id!=e.id)this.formatConfig(e,i),this.drawBG();else if(i!=this.section){var s=!("actions"==this.section&&"inventory"==i||"inventory"==this.section&&"actions"==i);this.section=i,s?this.drawBG():this.drawn.bg=!0}switch(this.section){case"main":case"game":this.ctxs[1].clearRect(0,0,this.cnvs[1].width,this.cnvs[1].height),this.drawTextarea(t.text),this.drawSelections(t.selections),this.drawn.ctx=!0;break;case"actions":this.ctxs[1].clearRect(0,0,this.cnvs[1].width,this.cnvs[1].height),this.drawTextarea(t.text),this.drawn.ctx=!0;break;case"inventory":if(this.drawn.ctx=!0,!t.preview)return this.drawInventory(t.items);this.drawInventory(t.items,t.preview);break;default:return}}},{key:"drawTextarea",value:function(t){var e=this.config["inventory"==this.section?"actions":this.section],i=e.textarea,s=e.colors.text,n=this.margin.left+i[0],a=this.margin.top+i[1],c=o(this.ctxs[1],t,i[2],i[3]),h=r(s[1]);this.ctxs[1].fillStyle=r(s[0]);for(var l=0,f=0;l<c.length;l+=1,f+=this.lineheight){if(null!==h){var u=this.ctxs[1].measureText(c[l]);this.ctxs[1].save(),this.ctxs[1].fillStyle=h,this.ctxs[1].fillRect(n,a+f-2,u.width,this.lineheight),this.ctxs[1].restore()}this.ctxs[1].fillText(c[l],n,a+f)}}},{key:"drawSelections",value:function(t){t=void 0===t?[]:t;var e=this.config[this.section],i=e.selections,s=e.colors.selection,n=e.colors.key,a=r(s[1]),c=r(n[0]),h=r(n[1]);this.ctxs[1].fillStyle=r(s[0]),this.selections=[];for(var l=0;l<t.length;l+=1)if(0==t[l].disabled){var f=this.selections.length,u=this.margin.left+i[f][0],d=this.margin.top+i[f][1],g=f+1+".",v=this.ctxs[1].measureText(g);v=v.width,null!==h&&(this.ctxs[1].save(),this.ctxs[1].fillStyle=h,this.ctxs[1].fillRect(u,d-2,v,this.lineheight),this.ctxs[1].restore()),this.ctxs[1].save(),this.ctxs[1].fillStyle=c,this.ctxs[1].fillText(g,u,d),this.ctxs[1].restore();for(var y=o(this.ctxs[1],t[l].text,i[f][2]-v,i[f][3]),x=0,m=0;x<y.length;x+=1,m+=this.lineheight){if(null!==a){var p=this.ctxs[1].measureText(y[x]);this.ctxs[1].save(),this.ctxs[1].fillStyle=a,this.ctxs[1].fillRect(u+v,d+m-2,p.width+16,this.lineheight),this.ctxs[1].restore()}this.ctxs[1].fillText(y[x],u+v+8,d+m)}this.selections.push(l)}}},{key:"drawInventory",value:function(t,e){if(e=void 0!==e&&e,0==t.length&&Array.isArray(t))return this.ctxs[1].clearRect(0,0,this.cnvs[1].width,this.cnvs[1].height),this.section="actions",this.drawTextarea(this.config.empty_inventory),[];var i=this.config.actions.inventory,s=i[0]+this.margin.left,n=i[1]+this.margin.top,a=this.config.actions.colors,c={id:0},h={key:{s:r(a.key[0]),f:r(a.key[1])},selection:{s:r(a.selection[0]),f:r(a.selection[1])},text:{s:r(a.text[0]),f:r(a.text[1])},selected:r(a.selected)},l={w:this.inventory.width,h:this.inventory.height,m:this.inventory.margin},f={x:0,y:0,w:l.w-2*l.m,t:l.h-4*l.m},u=[];if(this.ctxs[1].fillStyle=h.selection.s,t.id){c=t,t=this.inventory.items;var d=this.config.actions.textarea;this.ctxs[1].clearRect(d[0],d[1],d[2],d[3]),c.desc&&this.drawTextarea(c.desc)}else this.ctxs[1].clearRect(0,0,this.cnvs[1].width,this.cnvs[1].height),this.inventory.items=[];for(var g=0;g<t.length;g+=1)if(f.x=f.x+l.w+l.m+s>i[2]||0==g?0:f.x+l.w,f.y+=0==f.x&&g>0?l.h+l.m:0,i[3]>=f.y+l.h+l.m&&(0==c.id||c.id>0&&t[g].id==c.id)){var v=n+f.y+16,y=s+f.x+8,x=c.id>0&&c.selected||e&&t[g].selected?h.selected:h.selection.f;(c.id>0||e)&&this.ctxs[1].clearRect(f.x+s,f.y+n,l.w,l.h),null!==x&&(this.ctxs[1].save(),this.ctxs[1].fillStyle=x,this.ctxs[1].fillRect(f.x+s,f.y+n,l.w,l.h),this.ctxs[1].restore());var m=g+1+".",p=this.ctxs[1].measureText(m);p=p.width,null!==h.key.f&&(this.ctxs[1].save(),this.ctxs[1].fillStyle=h.key.f,this.ctxs[1].fillRect(y,v,p,this.lineheight),this.ctxs[1].restore()),this.ctxs[1].save(),this.ctxs[1].fillStyle=h.key.s,this.ctxs[1].fillText(m,y,v),this.ctxs[1].restore();for(var w=o(this.ctxs[1],t[g].name,f.w-p,f.h),A=w.length>2?2:w.length,b=0,k=0;k<A;k+=1,b+=this.lineheight){if(null!==h.text.f){var S=this.ctxs[1].measureText(w[k]);this.ctxs[1].save(),this.ctxs[1].fillStyle=h.text.f,this.ctxs[1].fillRect(y+p,v+b,S.width,this.lineheight),this.ctxs[1].restore()}this.ctxs[1].fillText(w[k],y+p,v+b)}var C=""!=t[g].unit&&void 0!==t[g].unit?" "+t[g].unit:"x",O=t[g].count>1?t[g].count+C:"x"==C?"":C;if(""!=O){if(null!==h.text.f){var T=this.ctxs[1].measureText(O);this.ctxs[1].save(),this.ctxs[1].fillStyle=h.text.f,this.ctxs[1].fillRect(y,v+b,T.width,this.lineheight),this.ctxs[1].restore()}this.ctxs[1].fillText(O,y,v+b)}0!=c.id||e||(u.push(t[g]),this.inventory.items.push({id:t[g].id,name:t[g].name,unit:t[g].unit,count:t[g].count,x:f.x+s,y:f.y+n}))}return u}},{key:"drawBG",value:function(){var t=this,e=this.config["inventory"==this.section?"actions":this.section];this.ctxs[0].clearRect(0,0,this.cnvs[0].width,this.cnvs[0].height),this.ctxs[0].fillStyle=r(this.codes[e.background]),this.ctxs[0].fillRect(0,0,this.cnvs[0].width,this.cnvs[0].height),null!==e.img?a(e.img).then((function(e){t.ctxs[0].drawImage(e,t.margin.left,t.margin.top),t.drawn.bg=!0})).catch((function(t){})):t.drawn.bg=!0}},{key:"formatConfig",value:function(t,e){this.config=["game","main","actions"].reduce((function(e,i){return e[i]=t[i],e}),{}),this.config.empty_inventory=t.empty_inventory,this.config.use_items=t.use_items,this.config.keys=[t.pickup,t.inventory,t.use],this.config.inventory=!1,this.config.id=t.id,this.section=e}},{key:"getElement",value:function(t){if("actions"==this.section)return{target:"actions"};var e=this.config[this.section],i=this.cnvs[1].getAttribute("width")/this.cnvs[1].offsetWidth,s=this.cnvs[1].getAttribute("height")/this.cnvs[1].offsetHeight,n=this,a="inventory"==this.section?["inventory"]:["selections","actions"];t.x*=i,t.y*=s;var r=a.map((function(i,s){var a="inventory"==i?n.inventory.items:e[i];return(a=Array.isArray(a)?a:[]).map((function(e,s){var a,r,o,c;if("inventory"==i?(a=e.x,r=e.x+n.inventory.width,o=e.y,c=e.y+n.inventory.height):(a=e[0]+n.margin.left,r=e[0]+e[2]+n.margin.left,o=e[1]+n.margin.top,c=e[1]+e[3]+n.margin.top),"selections"==i){var h=n.selections[s];return h=void 0!==h&&h,t.x>=a&&t.x<r&&t.y>=o&&t.y<c&&!1!==h?{ind:h,target:i}:null}if("actions"==i){var l=0==s?"pickup":1==s?"inventory":"use";return t.x>=a&&t.x<r&&t.y>=o&&t.y<c?{ind:s,target:l}:null}if("inventory"==i){var f=t.x>=a&&t.x<r&&t.y>=o&&t.y<c?e.id:null,u=null!==f?"item":null,d=null!==f?e.count:null;return f?{elem:u,id:f,count:d,target:"inventory"}:null}})).reduce((function(t,e){return e&&(t=e),t}),null)})).reduce((function(t,e){return e&&(t=e),t}),{target:null});return"inventory"==this.section&&null===r.target&&(r.target="inventory",r.elem=null),r}}])&&f(e.prototype,i),s&&f(e,s),t}();function d(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var g=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cnvs=e,this.ctxs=e.map((function(t){return t.getContext("2d")})),this.ctxs[1].textAlign="start",this.ctxs[1].textBaseline="top",this.margin={left:10,top:10},this.inventory=[],this.lineheight=24,this.radius=2,this.config={id:null},this.section=null,this.drawn={ctx:!1,bg:!1}}var e,i,s;return e=t,(i=[{key:"draw",value:function(t,e,i){if(this.drawn.ctx=!1,this.drawn.bg=!1,this.config.id!=e.id){var s=this.section?this.section:null;this.ctxs[1].clearRect(0,0,this.cnvs[1].width,this.cnvs[1].height),this.formatConfig(e,i),this.drawBG(s,!0),this.drawBorders(),this.drawHeader(t.name)}else if(i!=this.section){var n=!("actions"==this.section&&"inventory"==i||"inventory"==this.section&&"actions"==i),a=this.section?this.section:null;this.section=i,n?(this.drawBG(a),this.drawBorders(),this.drawHeader(t.name)):this.drawn.bg=!0}switch(this.section){case"main":this.drawTextarea(t.text),this.drawSelections(t.selections),this.clearActions(),this.drawn.ctx=!0;break;case"game":this.drawTextarea(t.text),this.drawSelections(t.selections),this.drawActions(),this.drawn.ctx=!0;break;case"actions":this.drawTextarea(t.text),this.clearSelections(),this.clearActions(),this.drawn.ctx=!0;break;case"inventory":return this.drawn.ctx=!0,this.drawInventory(t.items);default:return}}},{key:"drawBorders",value:function(){for(var t=this.config["inventory"==this.section?"actions":this.section],e=[49,220,588],i="game"==this.section?[49,220,588]:[49,588],s=0;s<e.length;s+=1)this.ctxs[1].clearRect(0,e[s],this.cnvs[1].width,10);this.ctxs[1].clearRect(0,0,this.cnvs[1].width,79);for(var n=0;n<i.length;n+=1){var a="border_"+(n+1);void 0!==t[a]&&(this.ctxs[1].save(),this.ctxs[1].fillStyle=t[a],this.ctxs[1].fillRect(this.margin.left,i[n],this.cnvs[1].width-2*this.margin.left,3),this.ctxs[1].restore())}}},{key:"drawHeader",value:function(t){var e=this.config["inventory"==this.section?"actions":this.section],i=this.cnvs[1].width-16-2*this.margin.left,s=c(e.header),n=c(e.header_bg),a=c(e.header_font_shadow);if(s){this.ctxs[1].save(),this.ctxs[1].font="normal 24px/1 "+e.header_font;var r=o(this.ctxs[1],t,i,24),f=this.ctxs[1].measureText(r[0]);this.ctxs[1].restore();var u={top:"at_line"==e.header_location?37:14};"middle"==e.header_align&&f.width<i?u.left=i/2-f.width/2:"right"==e.header_align?u.left=i+8:u.left=this.margin.left+8,n&&(this.ctxs[1].save(),this.ctxs[1].fillStyle=e.header_bg,h(this.ctxs[1],{x:"right"==e.header_align?u.left-8-f.width:u.left-8,y:u.top-4,w:f.width+19,h:32,r:[this.radius,this.radius,this.radius,this.radius]}),this.ctxs[1].fill(),this.ctxs[1].restore());var d=l(r[0],"normal 24px/1 "+e.header_font);this.ctxs[1].save(),this.ctxs[1].fillStyle=e.header,this.ctxs[1].textAlign="left"==e.header_align?"start":"right"==e.header_align?"end":"middle",this.ctxs[1].font="normal 24px/1 "+e.header_font,a&&(this.ctxs[1].shadowOffsetX=0,this.ctxs[1].shadowOffsetY=0,this.ctxs[1].shadowColor=e.header_font_shadow,this.ctxs[1].shadowBlur=5),this.ctxs[1].fillText(r[0],u.left,u.top-4+d.top),this.ctxs[1].restore()}}},{key:"drawTextarea",value:function(t){var e=this.config["inventory"==this.section?"actions":this.section],i=this.cnvs[1].width-24-2*this.margin.left,s=[];if(this.clearTextarea(),"no"!=e.text_display){var n=c(e.text_bg),a=c(e.text_font_shadow);this.ctxs[1].save(),this.ctxs[1].font="normal 16px/1 "+e.text_font;for(var r=o(this.ctxs[1],t,i,80),l=0;l<r.length;l+=1){var f=this.ctxs[1].measureText(r[l]);s.push(f.width)}this.ctxs[1].restore(),n&&(this.ctxs[1].save(),this.ctxs[1].fillStyle=e.text_bg,h(this.ctxs[1],{x:this.margin.left+12-8,y:72,w:i+19,h:24*r.length+12,r:[this.radius,this.radius,this.radius,this.radius]}),this.ctxs[1].fill(),this.ctxs[1].restore());for(var u=0;u<r.length;u+=1){var d=0,g=80+24*u,v=s[u];d="center"==e.text_align&&v<i?this.cnvs[1].width/2-v/2:"right"==e.text_align?i+12:this.margin.left+12,this.ctxs[1].save(),this.ctxs[1].fillStyle=e.text,this.ctxs[1].textAlign="left"==e.text_align?"start":"right"==e.text_align?"end":"middle",this.ctxs[1].font="normal 16px/1 "+e.text_font,a&&(this.ctxs[1].shadowOffsetX=0,this.ctxs[1].shadowOffsetY=0,this.ctxs[1].shadowColor=e.text_font_shadow,this.ctxs[1].shadowBlur=5),this.ctxs[1].fillText(r[u],d,g),this.ctxs[1].restore()}}}},{key:"clearTextarea",value:function(){this.ctxs[1].clearRect(0,72,this.cnvs[1].width,148)}},{key:"drawSelections",value:function(t){var e=this.config[this.section],i=(e.selections,257),s=141,n=0;this.clearSelections(),this.selections=[];var a=c(e.selections_bg),r=c(e.selections_key_bg),f=c(e.selections_font_shadow);this.ctxs[1].save(),this.ctxs[1].font="normal 16px/1 "+e.selections_font;for(var u=0;u<t.length;u+=1)for(var d=o(this.ctxs[1],t[u].text,650,48),g=0;g<d.length;g+=1){var v=this.ctxs[1].measureText(d[g]);v.width>n&&(n=v.width)}this.ctxs[1].restore();for(var y=0;y<t.length;y+=1)if(0==t[y].disabled){this.ctxs[1].save(),this.ctxs[1].font="normal 16px/1 "+e.selections_font;var x=this.selections.length+1+".",m=o(this.ctxs[1],t[y].text,650,48),p=m.length>2?2:m.length,w=0;if(this.ctxs[1].restore(),s="center"==e.text_align?this.cnvs[0].width/2-(n+28+20)/2:"right"==e.text_align?this.cnvs[1].width-12:this.margin.left+12,r){this.ctxs[1].save(),this.ctxs[1].fillStyle=e.selections_key_bg;var A="right"==e.text_align?a?this.radius:0:this.radius,b="right"==e.text_align?this.radius:a?0:this.radius;h(this.ctxs[1],{x:"right"==e.text_align?s-28:s,y:i-10,w:28,h:32,r:[b,b,A,A]}),this.ctxs[1].fill(),this.ctxs[1].restore()}this.ctxs[1].save(),this.ctxs[1].fillStyle=e.selections_key,this.ctxs[1].textAlign="start",this.ctxs[1].font="bold 16px/1 "+e.selections_font,f&&(this.ctxs[1].shadowOffsetX=0,this.ctxs[1].shadowOffsetY=0,this.ctxs[1].shadowColor=e.selections_font_shadow,this.ctxs[1].shadowBlur=5);var k=l(x,"bold 16px/1 "+e.selections_font);this.ctxs[1].fillText(x,"right"==e.text_align?s-12-8:s+8,i-10+k.top,28,24),this.ctxs[1].restore();for(var S=0;S<p;S+=1,w+=32){if(a){this.ctxs[1].save(),this.ctxs[1].fillStyle=e.selections_bg;var C="right"==e.text_align?this.radius:r?0:this.radius,O="right"==e.text_align&&r?0:this.radius;h(this.ctxs[1],{x:"right"==e.text_align?s-28-n-12-8:s+28,y:i+w-10,w:n+19,h:32,r:[O,O,C,C]}),this.ctxs[1].fill(),this.ctxs[1].restore()}var T=l(m[S],"normal 16px/1 "+e.selections_font);this.ctxs[1].save(),this.ctxs[1].fillStyle=e.selections,this.ctxs[1].textAlign="left"==e.text_align?"start":"right"==e.text_align?"end":"middle",this.ctxs[1].font="normal 16px/1 "+e.selections_font,f&&(this.ctxs[1].shadowOffsetX=0,this.ctxs[1].shadowOffsetY=0,this.ctxs[1].shadowColor=e.selections_font_shadow,this.ctxs[1].shadowBlur=5),this.ctxs[1].fillText(m[S],"right"==e.text_align?s-38:s+38,i+w-10+T.top),this.ctxs[1].restore()}this.selections.push({ind:y,pos:[s,i-10,n+19+28,w]}),i+=w+18}}},{key:"clearSelections",value:function(){this.selections=[],this.ctxs[1].clearRect(0,247,this.cnvs[1].width,336)}},{key:"drawActions",value:function(){if(this.config.use_items){var t,e=this.config[this.section],i=(e.selections,0),s=[],n=0;this.clearActions();var a=c(e.actions_bg),r=c(e.actions_key_bg),o=c(e.actions_font_shadow);this.ctxs[1].save(),this.ctxs[1].font="normal 16px/1 "+e.actions_font;for(var f=0;f<this.config.keys.length;f+=1)if(""!=this.config.keys[f][0]){var u=this.ctxs[1].measureText(this.config.keys[f][0]);s.push(u.width),i+=u.width+38+19}this.ctxs[1].restore(),i+=80,t=this.cnvs[1].width/2-i/2,this.actions=[];for(var d=0;d<this.config.keys.length;d+=1)if(""!=this.config.keys[d][0]){if(n+=0==d?0:s[d-1]+102,r){this.ctxs[1].save(),this.ctxs[1].fillStyle=e.actions_key_bg;var g=this.radius,v=a?0:this.radius;h(this.ctxs[1],{x:t+n,y:538,w:28,h:32,r:[v,v,g,g]}),this.ctxs[1].fill(),this.ctxs[1].restore()}this.ctxs[1].save(),this.ctxs[1].fillStyle=e.actions_key,this.ctxs[1].textAlign="start",this.ctxs[1].font="bold 16px/1 "+e.actions_font;var y=l(this.config.keys[d][1]+".","bold 16px/1 "+e.actions_font);if(o&&(this.ctxs[1].shadowOffsetX=0,this.ctxs[1].shadowOffsetY=0,this.ctxs[1].shadowColor=e.actions_font_shadow,this.ctxs[1].shadowBlur=5),this.ctxs[1].fillText(this.config.keys[d][1]+".",t+8+n,538+y.top,28,24),this.ctxs[1].restore(),a){this.ctxs[1].save(),this.ctxs[1].fillStyle=e.actions_bg;var x=r?0:this.radius,m=this.radius;h(this.ctxs[1],{x:t+n+28,y:538,w:s[d]+19,h:32,r:[m,m,x,x]}),this.ctxs[1].fill(),this.ctxs[1].restore()}this.ctxs[1].save(),this.ctxs[1].fillStyle=e.actions,this.ctxs[1].textAlign="start",this.ctxs[1].font="normal 16px/1 "+e.actions_font,o&&(this.ctxs[1].shadowOffsetX=0,this.ctxs[1].shadowOffsetY=0,this.ctxs[1].shadowColor=e.actions_font_shadow,this.ctxs[1].shadowBlur=5);var p=l(this.config.keys[d][0],"normal 16px/1 "+e.actions_font);this.ctxs[1].fillText(this.config.keys[d][0],t+n+38,538+p.top),this.ctxs[1].restore(),this.actions.push({ind:d,pos:[t+n,538,s[d]+28+19,32]})}}}},{key:"clearActions",value:function(){this.actions=[],this.ctxs[1].clearRect(0,546,this.cnvs[1].width,42)}},{key:"drawInventory",value:function(t){if(0==t.length&&Array.isArray(t))return this.clearInventory(),this.section="actions",this.drawTextarea(this.config.empty_inventory),[];var e=this.config.actions,i={top:0,left:0,line:1},s={w:236,h:56},n=e.selected_items,a={id:0},r=[];t.id?(a=t,t=this.inventory):(this.clearSelections(),this.clearActions(),this.clearTextarea(),this.clearInventory(),this.inventory=[]);for(var f=c(e.items_bg),u=c(e.items_key_bg),d=c(e.items_font_shadow),g=0,v=0;v<t.length;v+=1){if(i.line<=3&&(0==a.id||a.id>0&&t[v].id==a.id)){this.ctxs[1].save(),this.ctxs[1].font="normal 16px/1 "+e.items_font;var y=o(this.ctxs[1],t[v].name,s.w-2*s.padding-28-16,48),x=y.length>2?2:y.length;this.ctxs[1].restore();var m,p=120+i.top-10,w=80+i.left,A=""!=t[v].unit&&void 0!==t[v].unit?" "+t[v].unit:"x",b=t[v].count>1?t[v].count+A:"x"==A?"":A;if(g<(m=""!=b?s.h+32:s.h)&&(g=m),a.id>0&&this.ctxs[1].clearRect(w,p,s.w,m),(a.id>0&&a.selected||t[v].selected)&&(this.ctxs[1].save(),this.ctxs[1].fillStyle=n,h(this.ctxs[1],{x:w,y:p,w:s.w,h:m,r:[this.radius,this.radius,this.radius,this.radius]}),this.ctxs[1].fill(),this.ctxs[1].restore()),u){this.ctxs[1].save(),this.ctxs[1].fillStyle=e.items_key_bg;var k=this.radius,S=f?0:this.radius;h(this.ctxs[1],{x:w+12,y:p+12,w:28,h:32,r:[S,S,k,k]}),this.ctxs[1].fill(),this.ctxs[1].restore()}var C=v+1+".";this.ctxs[1].save(),this.ctxs[1].fillStyle=e.items_key,this.ctxs[1].textAlign="start",this.ctxs[1].font="bold 16px/1 "+e.items_font,d&&(this.ctxs[1].shadowOffsetX=0,this.ctxs[1].shadowOffsetY=0,this.ctxs[1].shadowColor=e.items_font_shadow,this.ctxs[1].shadowBlur=5);var O=l(C,"bold 16px/1 "+e.items_font);this.ctxs[1].fillText(C,w+12+8,p+12+O.top,28,24),this.ctxs[1].restore();for(var T=0,_=0;_<x;_+=1,T+=32){if(f){this.ctxs[1].save(),this.ctxs[1].fillStyle=e.items_bg;var D=u?0:this.radius,E=this.radius;h(this.ctxs[1],{x:w+12+28,y:p+12,w:s.w-24-28,h:32,r:[E,E,D,D]}),this.ctxs[1].fill(),this.ctxs[1].restore()}this.ctxs[1].save(),this.ctxs[1].fillStyle=e.items,this.ctxs[1].textAlign="start",this.ctxs[1].font="normal 16px/1 "+e.items_font;var B=l(y[_],"normal 16px/1 "+e.items_font);d&&(this.ctxs[1].shadowOffsetX=0,this.ctxs[1].shadowOffsetY=0,this.ctxs[1].shadowColor=e.items_font_shadow,this.ctxs[1].shadowBlur=5),this.ctxs[1].fillText(y[_],w+12+28+8,p+12+T+B.top),this.ctxs[1].restore()}if(""!=b){if(f){this.ctxs[1].save(),this.ctxs[1].fillStyle=e.items_bg,this.ctxs[1].textAlign="start",this.ctxs[1].font="normal 16px/1 "+e.items_font;var I=this.ctxs[1].measureText(b);h(this.ctxs[1],{x:w+12+28,y:p+T+12,w:I.width+16,h:32,r:[0,this.radius,this.radius,0]}),this.ctxs[1].fill(),this.ctxs[1].restore()}this.ctxs[1].save(),this.ctxs[1].fillStyle=e.items,this.ctxs[1].textAlign="start",this.ctxs[1].font="normal 16px/1 "+e.items_font,d&&(this.ctxs[1].shadowOffsetX=0,this.ctxs[1].shadowOffsetY=0,this.ctxs[1].shadowColor=e.selections_font_shadow,this.ctxs[1].shadowBlur=5);var M=l(b,"normal 16px/1 "+e.items_font);this.ctxs[1].fillText(b,w+12+28+8,p+12+T+M.top),this.ctxs[1].restore()}0==a.id&&(r.push(t[v]),this.inventory.push({id:t[v].id,name:t[v].name,unit:t[v].unit,count:t[v].count,x:w,y:p,w:s.w,h:m}))}i.left>2*s.w?(i.left=0,i.top+=g+40,i.line+=1,g=0):i.left+=s.w+40}return r}},{key:"clearInventory",value:function(){this.ctxs[1].clearRect(0,223,this.cnvs[1].width,365)}},{key:"drawBG",value:function(t,e){var i=this,s=this.config["inventory"==this.section?"actions":this.section];e=void 0!==e;var n=t||null;((t=(t="inventory"==t?"actions":t)?this.config[t]:{}).background_img!=s.background_img&&null!==s.background_img||!n)&&(this.ctxs[0].clearRect(0,0,this.cnvs[0].width,this.cnvs[0].height),this.ctxs[0].fillStyle=null!==s.background?s.background:"none",this.ctxs[0].fillRect(0,0,this.cnvs[0].width,this.cnvs[0].height)),null!==s.background_img&&t.background_img!=s.background_img||e&&null!==s.background_img?a(s.background_img).then((function(t){var e=0;!function s(){e+=.05,i.ctxs[0].globalAlpha=e,i.ctxs[0].clearRect(0,0,i.cnvs[0].width,i.cnvs[0].height),i.ctxs[0].fillStyle="#000",i.ctxs[0].drawImage(t,0,0),e<1?window.requestAnimationFrame(s):(i.loading=!1,i.drawn.bg=!0)}()})).catch((function(t){})):i.drawn.bg=!0}},{key:"formatConfig",value:function(t,e){this.config=["game","main","actions"].reduce((function(e,i){return e[i]=t[i],e}),{}),this.config.empty_inventory=t.empty_inventory,this.config.use_items=t.use_items,this.config.keys=[t.pickup,t.inventory,t.use],this.config.inventory=!1,this.config.id=t.id,this.section=e}},{key:"getElement",value:function(t){if("actions"==this.section)return{target:"actions"};this.config[this.section];var e=this.cnvs[1].getAttribute("width")/this.cnvs[1].offsetWidth,i=this.cnvs[1].getAttribute("height")/this.cnvs[1].offsetHeight,s=this,n="inventory"==this.section?["inventory"]:["selections","actions"];t.x*=e,t.y*=i;var a=n.map((function(e,i){var n=[];switch(e){case"selections":n=s.selections;break;case"actions":n=s.actions;break;case"inventory":n=s.inventory;break;default:n=[]}return n.map((function(i,n){var a,r,o,c;if("inventory"==e?(a=i.x,r=i.x+i.w,o=i.y,c=i.y+i.h):(a=i.pos[0],r=i.pos[0]+i.pos[2],o=i.pos[1],c=i.pos[1]+i.pos[3]),"selections"==e){var h=s.selections[n];return h=void 0!==i.ind&&i.ind,t.x>=a&&t.x<r&&t.y>=o&&t.y<c&&!1!==h?{ind:h,target:e}:null}if("actions"==e){var l=0==n?"pickup":1==n?"inventory":"use";return t.x>=a&&t.x<r&&t.y>=o&&t.y<c?{ind:n,target:l}:null}if("inventory"==e){var f=t.x>=a&&t.x<r&&t.y>=o&&t.y<c?i.id:null,u=null!==f?"item":null,d=null!==f?i.count:null;return f?{elem:u,id:f,count:d,target:"inventory"}:null}})).reduce((function(t,e){return e&&(t=e),t}),null)})).reduce((function(t,e){return e&&(t=e),t}),{target:null});return"inventory"==this.section&&null===a.target&&(a.target="inventory",a.elem=null),a}}])&&d(e.prototype,i),s&&d(e,s),t}();function v(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.oldskool=new u(e),this.traditional=new g(e),this.type=0}var e,i,s;return e=t,(i=[{key:"drawScreen",value:function(t,e,i){return this.type=e.type,1==this.type?this.traditional.draw(t,e,i):this.oldskool.draw(t,e,i)}},{key:"getElement",value:function(t){return 1==this.type?this.traditional.getElement(t):this.oldskool.getElement(t)}},{key:"isDrawn",value:function(){var t=1==this.type?this.traditional:this.oldskool;return t.drawn.ctx&&t.drawn.bg}},{key:"getKeyElement",value:function(t){var e=1==this.type?this.traditional:this.oldskool;if("actions"==e.section)return{target:"actions"};var i=e.config,s=e.section,n=this.type,a=2==n?i.keys:i.keys.map((function(t){return t[1]})),r=i[s],o=("inventory"==s?["inventory"]:["selections","actions"]).map((function(i,s){var o=[];if(1==n)switch(i){case"selections":o=e.selections;break;case"actions":o=e.actions;break;case"inventory":o=e.inventory;break;default:o=[]}else o="inventory"==i?e.inventory.items:r[i],o=Array.isArray(o)?o:[];return o.map((function(s,r){if("selections"==i){var o=e.selections[r];return o=2==n?void 0!==o&&o:void 0!==s.ind&&s.ind,t==r+1&&!1!==o?{ind:o,target:i}:null}if("actions"==i){var c=0==r?"pickup":1==r?"inventory":"use",h=a[r];return t==h?{ind:r,target:c}:null}if("inventory"==i){var l=t==r+1?s.id:null,f=null!==l?"item":null,u=null!==l?s.count:null;return l?{elem:f,id:l,count:u,target:"inventory"}:null}})).reduce((function(t,e){return e&&(t=e),t}),null)})).reduce((function(t,e){return e&&(t=e),t}),{target:null});return"inventory"==s&&null===o.target&&(o.target="inventory",o.elem=null),o}}])&&v(e.prototype,i),s&&v(e,s),t}(),x=function(){return{screen_id:0,level_id:0,items:[],all_items:[],sel_items:[],actions:[],pickup_times:0,inventory:[],action_on:!1,move_after:0}};function m(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var p=function(){function t(e,i,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i=void 0!==i?i:"Loading, please wait..",this.canvas=e,this.ctx=e.getContext("2d"),this.text=i,this.reset(),this.target=s}var e,i,s;return e=t,(i=[{key:"reset",value:function(){this.canvas.style.opacity=1,this.canvas.style.WebkitTransition="opacity .6s, transform .6s",this.canvas.style.transition="opacity .6s, transform .6s",this.canvas.style.WebkitTransform="scale3d(1, 1, 1)",this.canvas.style.WebkitTransformOrigin="center center",this.canvas.style.transform="scale3d(1, 1, 1)",this.canvas.style.transformOrigin="center center",this.canvas.style.display="block"}},{key:"show",value:function(){var t=this;this.loading=!0,this.ctx.font="normal 16px fsex300",this.ctx.textAlign="start",this.ctx.textBaseline="top",a("data:image/png;base64,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").then((function(e){var i=t.canvas.width/2,s=t.canvas.height/2,n=i-e.width/2,a=s-e.height,r=i-t.ctx.measureText(t.text).width/2,o=s+40,c=0;!function i(){c+=.04,t.ctx.globalAlpha=c,t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.ctx.drawImage(e,n,a),t.ctx.fillText(t.text,r,o),c<1?window.requestAnimationFrame(i):(t.loading=!1,t.target.style.background="#000")}()})).catch((function(t){}))}},{key:"hide",value:function(){var t=this,e=this,i=function(){var t,e=document.createElement("div"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in i)if("undefined"!==e.style[t])return i[t]}();this.loading?setTimeout((function(){t.hide()}),200):(e.canvas.addEventListener(i,(function t(s){/opacity/i.test(s.propertyName)&&(e.canvas.removeEventListener(i,t),e.canvas.style.display="none")})),setTimeout((function(){e.canvas.style.transform="scale3d(1.4, 1.4, 1)",e.canvas.style.opacity=0}),200))}}])&&m(e.prototype,i),s&&m(e,s),t}();function w(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function A(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function b(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function C(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function O(t,e){return(O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function T(t,e,i){return(T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var s=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_(t)););return t}(t,e);if(s){var n=Object.getOwnPropertyDescriptor(s,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var D=function(t){function e(t,i){var s,n,a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=this,(s=!(a=_(e).call(this))||"object"!==k(a)&&"function"!=typeof a?C(n):a).settings={save:t.save&&t.short,id:t.short};var r="object"===k(t.data)?data:{},o=T(_(e.prototype),"getLocal",C(s)).call(C(s),s.settings);return s.game=t.game,s.state=o?Object.assign(o,r):Object.assign(x(),r),s.canvas=t.cnvs[1],s.layout=new y(t.cnvs),s.loader=new p(t.cnvs[2],t.loader_text,t.target),s.loader.show(),s.loading=!1,s.state.screen_id=0==s.state.screen_id?s.game.startup:s.state.screen_id,s.initEvents(),s.drawScreen(),s.loader.hide(),s}var i,s,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(e,t),i=e,(s=[{key:"reset",value:function(t){this.settings={save:t.save&&t.short,id:t.short};var i="object"===k(t.data)?data:{},s=T(_(e.prototype),"getLocal",this).call(this,this.settings);this.game=t.game,this.state=s?Object.assign(s,i):Object.assign(x(),i),delete this.layout,this.layout=new y(t.cnvs),delete this.loader,this.loader=new p(t.cnvs[2],t.loader_text,t.target),this.state.screen_id=0==this.state.screen_id?this.game.startup:this.state.screen_id,this.drawScreen(),this.loader.hide(),this.loading=!1}},{key:"reload",value:function(){this.state=Object.assign(x(),{}),this.state.screen_id=this.game.startup,T(_(e.prototype),"removeLocal",this).call(this,this.settings),this.drawScreen(),this.loading=!1}},{key:"pause",value:function(){this.loading=!0}},{key:"drawScreen",value:function(t,i,s){t=void 0===t?this.state.screen_id==this.game.startup?"main":"game":t,s=void 0!==s;var n=T(_(e.prototype),"getScreen",this).call(this),a=T(_(e.prototype),"getTheme",this).call(this,n.theme_id),r={name:this.game.name};if(a.use_items=this.game.use_items,"game"==t||"main"==t?(r.text=T(_(e.prototype),"parseText",this).call(this,n.text),r.selections=T(_(e.prototype),"parseSelections",this).call(this,n.selections)):"actions"==t?r.text=i:"inventory"==t&&(r.items=i),s)return this.layout.drawScreen(r,a,t);this.layout.drawScreen(r,a,t)}},{key:"initEvents",value:function(){var t=this;this.dragging=!1,T(_(e.prototype),"onDragging",this).call(this,this);var i=T(_(e.prototype),"clickEvent",this).call(this),s=this;this.canvas.addEventListener(i,(function(i){if(!s.loading&&!s.dragging){var n=T(_(e.prototype),"getElementOffset",t).call(t,i),a=t.layout.getElement(n);s.onEvent(a),T(_(e.prototype),"saveLocal",t).call(t,t.state,t.settings)}}),!1),window.addEventListener("keydown",(function(i){if(!s.loading){var n=t.layout.getKeyElement(i.key);s.onEvent(n),T(_(e.prototype),"saveLocal",t).call(t,t.state,t.settings)}}))}},{key:"onEvent",value:function(t){switch(t.target){case"selections":this.onMovement(t.ind);break;case"actions":this.state.move_after>0&&(this.state.screen_id=this.state.move_after,this.state.move_after=0),this.state.inventory.length>0?this.drawScreen("inventory",T(_(e.prototype),"getInventory",this).call(this,!0)):this.drawScreen();break;case"pickup":this.onPickup();break;case"inventory":this.onInventory(t);break;case"use":this.state.action_on=!0,this.onInventory(t);break;default:return}}},{key:"onMovement",value:function(t){var i=T(_(e.prototype),"getScreen",this).call(this,this.state.screen_id).selections[t];0==i.disabled&&(i.movement&&!i.requires_action?(this.state.screen_id=i.movement,this.drawScreen()):i.movement&&i.requires_action?T(_(e.prototype),"getIsActionPerformed",this).call(this,i.requires_action.id,!1)&&(this.state.screen_id=i.movement,this.drawScreen()):i.action&&(i.action.ind=t,this.onAction(i.action,!1)))}},{key:"onPickup",value:function(){var t=T(_(e.prototype),"getScreen",this).call(this),i=this;if(999!=t.items.length){var s=t.items.map((function(t){var e=i.state.all_items.map((function(e,s){return e.id==t.id&&e.screen_id==i.state.screen_id&&e})).reduce((function(t,e){return e&&(t=e),t}),{times:0});return{itm:t,type:0==t.times?0:e.times==t.times?2:1}}));this.game.pickup_times=void 0===this.game.pickup_times?0:this.game.pickup_times;var n=T(_(e.prototype),"shuffle",this).call(this,s.filter((function(t){return 0==t.type}))),a=T(_(e.prototype),"shuffle",this).call(this,s.filter((function(t){return 1==t.type}))),r=this.game.pickup_times%3==0?n.concat(a):a.concat(n);if(r="object"===k(r[0])?r[0].itm:null,this.game.pickup_times+=1,null!==r){var o=null!==r.potential?parseInt(r.potential):100,c=this.game.items[r.id];o>=Math.floor(100*Math.random())+1?(T(_(e.prototype),"addGainedItems",this).call(this,[r]),this.drawScreen("actions",T(_(e.prototype),"getMessage",this).call(this,"pickup","success",r.pickup_text,c.pickup_text,!0))):this.drawScreen("actions",T(_(e.prototype),"getMessage",this).call(this,"pickup","fail",r.fail_text,c.fail_text,!0))}else this.drawScreen("actions",T(_(e.prototype),"getFailMessage",this).call(this,"pickup"))}else this.drawScreen("actions","EI LÖYDY")}},{key:"onInventory",value:function(t){if(void 0===t.elem){var i=this.drawScreen("inventory",T(_(e.prototype),"getInventory",this).call(this),!0);this.state.inventory=[].concat(b(this.state.inventory),b(i))}else if("item"==t.elem)if(this.state.action_on)this.state.sel_items.find((function(e){return e.id==t.id}))?(this.state.sel_items=this.state.sel_items.map((function(e){if(e.id!=t.id)return e})).reduce((function(t,e){return e&&t.push(e),t}),[]),this.drawScreen("inventory",{id:t.id,selected:!1})):(this.state.sel_items.push({id:t.id,count:t.count}),this.drawScreen("inventory",{id:t.id,selected:!0,desc:this.game.items[t.id].description}));else{var s=this.game.items[t.id].description;this.drawScreen("actions",s)}else{var n=T(_(e.prototype),"getInventory",this).call(this);if(0==n.length)this.state.action_on?this.state.sel_items.length>0?this.onAction(null,!0):(this.state.action_on=!1,this.state.inventory=[],this.drawScreen()):(this.drawScreen(),this.state.inventory=[]);else{var a=this.drawScreen("inventory",n,!0);this.state.inventory=[].concat(b(this.state.inventory),b(a))}}}},{key:"onAction",value:function(t,i){var s=i?T(_(e.prototype),"getAction",this).call(this,null):T(_(e.prototype),"getAction",this).call(this,t.id),n=this;if(null===t&&(t=s[0],s=s[1]),!s)return this.state.inventory=[],this.state.sel_items=[],this.state.action_on=!1,void this.drawScreen("actions",T(_(e.prototype),"getFailMessage",this).call(this,"action"));var a=0==s.required_items.length||s.required_items.map((function(t){return void 0!==(i?n.state.sel_items:n.state.items).find((function(e){return e.id==t.id&&e.count>=t.amount}))})).reduce((function(t,e){return e||(t=!1),t}),!0),r=!!i&&this.state.actions.map((function(e){return s.id==e.id&&e.screen_id==n.state.screen_id&&e.times<=t.times&&t.times>0})).reduce((function(t,e){return e&&(t=!0),t}),!1);if(this.state.inventory=[],this.state.sel_items=[],this.state.action_on=!1,a&&!r){var o=t.lose_items,c=t.potential?parseInt(t.potential):100,h=Math.floor(100*Math.random())+1,l=(t.times&&t.times,t.move_after?t.move_after:0);this.state.items=o?this.state.items.map((function(t){var e=s.required_items.find((function(e){return e.id==t.id}));return void 0!==e?(t.count-=e.amount,t.count<=0?null:t):t})).reduce((function(t,e){return e&&t.push(e),t}),[]):this.state.items,c>=h?(T(_(e.prototype),"addGainedItems",this).call(this,s.gained_items),T(_(e.prototype),"addPerformedAction",this).call(this,s),l&&(this.state.move_after=l),this.drawScreen("actions",T(_(e.prototype),"getMessage",this).call(this,"action","success",t.success_text,s.success_text,i))):this.drawScreen("actions",T(_(e.prototype),"getMessage",this).call(this,"action","fail",t.fail_text,s.fail_text,i))}else a||r?a&&r&&this.drawScreen("actions",T(_(e.prototype),"getMessage",this).call(this,"action","fail",""!=t.fail_after?t.fail_after:t.fail_text,s.fail_text,i)):this.drawScreen("actions",T(_(e.prototype),"getMessage",this).call(this,"action","fail",t.lacks_text,s.lacks_text,i))}}])&&S(i.prototype,s),n&&S(i,n),e}(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storage=function(t){try{var e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}("localStorage")}var e,i,s;return e=t,(i=[{key:"getScreen",value:function(){var t=this.state.screen_id,e=this.game.screens[t].level_id,i=Object.assign({},this.game.levels[e].screens[t]);return i.theme_id=this.game.levels[e].theme,i}},{key:"getTheme",value:function(t){return Object.assign({},this.game.themes[t])}},{key:"getAction",value:function(t){if(t)return this.game.actions[t];var e=this.getScreen(),i=this.state,s=null,n=i.sel_items.reduce((function(t,e){return t.push(e.id),t}),[]),a=this;if((s=[].concat(w(e.actions),w(e.selections)).map((function(t){var i=!0,s=!1,r=!1;if(void 0!==t.movement&&(r=!0,s=1==t.disabled,i=!(0==t.action),t=t.action),!i||s)return null;var o=a.game.actions[t.id],c=0!=o.required_items.length&&o.required_items.map((function(t){return-1!==n.indexOf(t.id)})).reduce((function(t,e){return e||(t=!1),t}),!0),h=n.map((function(t){var e=!1;return o.required_items.map((function(i){i.id==t&&(e=!0)})),e})).reduce((function(t,e){return e||(t=!0),t}),!1);if(c&&!h){var l=!!r&&e.actions.find((function(e){return e.id==t.id}));return(l=void 0!==l&&l)?null:t}})).reduce((function(t,e){return e&&t.push(e),t}),[])).length>1){var r=[],o=[];s.map((function(t){var n=t.times?t.times:0,a=!1;i.actions.map((function(t){s.id==t.id&&e.id==t.screen&&t.times>=n&&n>0&&(a=!0)})),a?r.push(t):o.push(t)}));var c=[].concat(w(this.shuffle(o)),w(this.shuffle(r)));return[c[0],this.game.actions[c[0].id]]}return 0!=s.length&&[s[0],this.game.actions[s[0].id]]}},{key:"addGainedItems",value:function(t){var e=this,i=this;t.map((function(t){var s=t.amount?t.amount:t.gained,n=isNaN(s)?function(){var t=s.split("-");return Math.floor(Math.random()*(parseInt(t[1])-parseInt(t[0])+1)+parseInt(t[0]))}:parseInt(s),a=!1;e.state.items=e.state.items.map((function(e){return e.id==t.id&&(a=!0,e.count+=n),e})),a||e.state.items.push({id:t.id,count:n}),t.gained&&(a=!1,e.state.all_items=e.state.all_items.map((function(e){return e.id==t.id&&e.screen_id==i.state.screen_id&&(a=!0,e.times+=1),e})),a||e.state.all_items.push({id:t.id,times:1,screen_id:i.state.screen_id}))}))}},{key:"addPerformedAction",value:function(t){var e=!1,i=this;this.state.actions=this.state.actions.map((function(s){return s.id==t.id&&s.screen_id==i.state.screen_id&&(e=!0,s.times+=1),s})),e||this.state.actions.push({id:t.id,screen_id:this.state.screen_id,times:1})}},{key:"getIsActionPerformed",value:function(t,e){var i=this.state.screen_id;return void 0!==this.state.actions.find((function(s){return e?i==s.screen_id&&t==s.id:t==s.id}))}},{key:"getMessage",value:function(t,e,i,s,n){i=void 0===i?"":i,s=void 0===s?"":s;var a=n&&""!=i?i:s;return""==a?"success"==e?"action"==t?"Action performed!":"Pickup success!":this.getFailMessage(t):a}},{key:"getFailMessage",value:function(t){var e="action"==t?"action_fail":"pick_up_fail",i=this.getScreen(),s=this.game.levels[this.game.screens[i.id].level_id];return""==i[e]?""==s[e]?""==this.game[e]?"action"==t?"Action didn't work out":"Pick-up didn't work out":this.game[e]:s[e]:i[e]}},{key:"getHasItem",value:function(t){return this.state.screen_id,void 0!==this.state.all_items.find((function(e){return t==e.id}))}},{key:"parseText",value:function(t){for(var e=/\[([^\]]+)]/g,i=null,s=[],n={},a=this,r=(this.getScreen(),0);i=e.exec(t);){var o=i[0].toLowerCase();if(0==r&&o.length>=6){var c=parseInt(o.slice(2,-2));n={id:c,expr:i[0],type:"a"==o.charAt(1)?"action":"item",when:"b"==o.charAt(o.length-2)?"before":"after",err:!!("a"!=o.charAt(1)&&"i"!=o.charAt(1)||"b"!=o.charAt(o.length-2)&&"a"!=o.charAt(o.length-2)||isNaN(c)),start:n.start=i.index},r+=1}else 1==r&&(n.end=i.index+4,4==o.length&&("a"==o.charAt(2)&&"action"==n.type||"i"==o.charAt(2)&&"item"==n.type)&&!n.err?(n.err=!1,n.caption=t.slice(n.start+n.expr.length,i.index),n.caption=n.caption.trim()):n.err=!0,s.push(n),n={},r=0)}return s.map((function(e){if(!e.err){var i,s=e.id-88,n="action"==e.type?a.getIsActionPerformed(s,!1):a.getHasItem(s),r="action"==e.type?"a":"i";r+=e.id,r+="before"==e.when?"b":"a",i="action"==e.type?new RegExp("\\["+r+"\\](.*?)\\[\\/a\\]"):new RegExp("\\["+r+"\\](.*?)\\[\\/i\\]"),n="before"==e.when?!n:n,t=n?t.replace(i,e.caption):t.replace(i,"")}})),t}},{key:"parseSelections",value:function(t){var e=this;return t.map((function(t){var i=Object.assign({},t);return t.action&&t.action.remove_after&&e.getIsActionPerformed(t.action.id,!1)&&(i.disabled=1),t.requires_action&&(t.requires_action.show_before||e.getIsActionPerformed(t.requires_action.id,!1)||(i.disabled=1)),i}))}},{key:"getInventory",value:function(t){var e=void 0!==t?0:this.state.inventory.length,i=this.game.items;return this.state.items.map((function(t,s){if(s>e||0==e)return{id:t.id,name:i[t.id].name,unit:i[t.id].unit,count:t.count}})).reduce((function(t,e){return e&&t.push(e),t}),[])}},{key:"onDragging",value:function(t){document.body.addEventListener("touchmove",(function(){t.dragging=!0})),document.body.addEventListener("touchstart",(function(){t.dragging=!1}))}},{key:"clickEvent",value:function(){return"click"}},{key:"getElementOffset",value:function(t){var e=this.canvas.getBoundingClientRect(),i=e.left+(document.body.scrollLeft||document.documentElement.scrollLeft),s=e.top+(document.body.scrollTop||document.documentElement.scrollTop);return{x:t.pageX-i,y:t.pageY-s}}},{key:"shuffle",value:function(t){if(t.length<2)return t;for(var e=t.length-1;e>0;e-=1){var i=Math.floor(Math.random()*(e+1)),s=[t[i],t[e]];t[e]=s[0],t[i]=s[1]}return t}},{key:"saveLocal",value:function(t,e){e.save&&this.storage&&localStorage.setItem(e.id,JSON.stringify(t))}},{key:"getLocal",value:function(t){if(t.save&&this.storage){var e=localStorage.getItem(t.id);return e?JSON.parse(e):null}}},{key:"removeLocal",value:function(t){t.save&&this.storage&&localStorage.getItem(t.id)&&localStorage.removeItem(t.id)}}])&&A(e.prototype,i),s&&A(e,s),t}());function E(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}i.d(e,"default",(function(){return B}));var B=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var i=[],s=document.querySelector(e.target);this.loading=!0,s.style.overflow="hidden";for(var n=0;n<3;n+=1){var a=document.createElement("canvas");a.width=960,a.height=640,a.style.cssText=0==n?"display: block; position: relative; z-index: 2;":"display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 3;",2==n&&(a.style.background="radial-gradient(ellipse at center,#fcfcfc 0%,#e9e9e9 100%)",e.autoplay||(a.style.display="none")),s.appendChild(a),i.push(a)}e.autoplay=void 0===e.autoplay||e.autoplay,e.fonts=void 0!==e.fonts?e.fonts:"fonts/fonts.css",e.preload=void 0===e.preload||e.preload,e.save=void 0!==e.save&&e.save,this.target=s,this.cnvs=i,this.settings=e,this.loadedFonts=[],e.autoplay&&e.game?this.play(e.game):this.loading=!1}var e,i,s;return e=t,(i=[{key:"initFonts",value:function(t,e){var i=[],s=[],a=this.settings.fonts,r=this,o={actions:["header_font","items_font","text_font"],game:["actions_font","header_font","selections_font","text_font"],main:["header_font","selections_font","text_font"]},c=["TimesNewRoman","Arial","Georgia","ComicSansMS","PalatinoLinotype","LucidaSans"];for(var h in t.levels){var l=t.levels[h].theme;i.includes(l)||i.push(l)}i.map((function(e){var i=t.themes[e];if(1==i.type){var n=function(t){o[t].map((function(e){c.includes(i[t][e])||s.includes(i[t][e])||r.loadedFonts.includes(i[t][e])||(s.push(i[t][e]),r.loadedFonts.push(i[t][e]))}))};for(var a in o)n(a)}else s.includes("fsex300")||r.loadedFonts.includes("fsex300")||(s.push("fsex300"),r.loadedFonts.push("fsex300"))})),s.length>0&&this.settings.preload?n.a.load({custom:{families:s,urls:[a]},active:function(){e()}}):e()}},{key:"normalizeData",value:function(t){return t.screens={},["actions","items","levels","themes"].forEach((function(e){t[e]=function e(i){var s={};return i.map((function(i){i.screens&&(i.screens.map((function(e){t.screens[e.id]={level_id:i.id}})),i.screens=e(i.screens)),s[i.id]=i})),s}(t[e])})),t}},{key:"play",value:function(t){var e=this.cnvs,i=this;(t=this.normalizeData(t)).short=void 0===t.short?null:t.short,this.loading=!0,this.initFonts(t,(function(){var s={game:t,cnvs:e,target:i.target,save:i.settings.save,short:t.short};i.game?i.game.reset(Object.assign({},s)):i.game=new D(Object.assign({},s)),i.loading=!1}))}},{key:"pause",value:function(){this.game&&this.game.pause()}},{key:"reload",value:function(){this.game&&this.game.reload()}},{key:"preview",value:function(t,e,i){if(!this.loading){var s=new y(this.cnvs),n=this;"actions"==i&&2==e.type&&(i="inventory");var a=document.querySelector("#game_engine"),r=document.createElement("div");r.style.cssText="display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 4;",r.addEventListener("click",(function o(){n.loading||("actions"==i&&1==e.type?(i="inventory",s.drawScreen(t,e,i)):(r.removeEventListener("click",o),r.parentNode.removeChild(r),a.style.display="none"))}),!1),this.target.appendChild(r),t.preview=!0,s.drawScreen(t,e,i),a.style.display="block",n.loading=!1}}},{key:"generateGameImage",value:function(t){var e=this,i=this;return new Promise((function(s,n){try{var a=i.cnvs,r=new y(i.cnvs);(t=i.normalizeData(t)).short=void 0===t.short?null:t.short,i.loading=!0,e.initFonts(t,(function(){var e=t.startup,n=t.screens[e].level_id,o=Object.assign({},t.levels[n].screens[e]),c=t.levels[n].theme,h=Object.assign({},t.themes[c]),l={name:t.name};h.use_items=t.use_items,l.text=o.text,l.selections=o.selections,r.drawScreen(l,h,"main"),function t(){if(r.isDrawn()){var e=document.createElement("canvas");e.width=960,e.height=640;var n=e.getContext("2d");n.drawImage(a[0],0,0),n.drawImage(a[1],0,0);var o=e.toDataURL("image/png");i.loading=!1,s(o)}else setTimeout((function(e){t()}),100)}()}))}catch(t){i.loading=!1,n(t)}}))}}])&&E(e.prototype,i),s&&E(e,s),t}();window.SATUEngine=B}]);